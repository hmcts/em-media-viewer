<form #form (click)="onCommentClick()" class="aui-comment"
      [style.top.px]="commentTop"
      [style.zIndex]="selected ? 100 : 0"
      [ngClass]="'rotation rot' + rotate">
  <div id="detailsWrapper {{index}}" class="aui-comment__header">
    <span *ngIf="author && !editor" class="aui-comment__author">
      {{ author.forename }} {{ author.surname }}
    </span>
    <span *ngIf="editor" class="aui-comment__author">
      {{ editor.forename }} {{ editor.surname }}
    </span>
    <time [hidden]="!selected && !this.editable" class="aui-comment__meta">
      {{ lastUpdate | date: 'd MMMM y h:mm a' }}
    </time>
  </div>
  <tag-input [ngModel]="[]" [ngModelOptions]="{standalone:true}"
             [placeholder]="'Add tag'"
             [onTextChangeDebounce]="500"
             [secondaryPlaceholder]="'Search in Github'"
             [onlyFromAutocomplete]="false">
    <tag-input-dropdown
      [autocompleteObservable]="requestAutocompleteItemsFake"
      [minimumTextLength]="0">
      <ng-template let-item="item" let-index="index">
        {{ item.display }}
      </ng-template>
    </tag-input-dropdown>
  </tag-input>
  <ng-container *ngIf="selected">
    <textarea #textArea
              mvTextAreaAutoExpand
              type="text"
              required
              name="content"
              [maxlength]="COMMENT_CHAR_LIMIT"
              (focusout)="onFocusOut()"
              [ngClass]="commentStyle()"
              [(ngModel)]="fullComment"
              [readOnly]="!editable"
              (ngModelChange)="reRenderComments(); onCommentChange($event);"
              aria-label="comment">
    </textarea>
  </ng-container>
  <div *ngIf="!selected" class="unselectedText">
    {{fullComment}}
  </div>
  <ng-container *ngIf="selected || this.editable">
    <div class="aui-comment__footer commentBtns">
      <button *ngIf="!editable; else Save"
              class="govuk-button" type="button" role="button"
              (click)="onEdit()">
        Edit
      </button>
      <button *ngIf="!editable; else Cancel"
              type="button" role="button"
              class="govuk-button govuk-button--secondary"
              (click)="onDelete()">
        Delete
      </button>
    </div>
  </ng-container>
  <ng-template #Save>
    <button class="govuk-button" type="button" role="button"
            (click)="onSave()">
      Save
    </button>
  </ng-template>
  <ng-template #Cancel>
    <button type="button" role="button"
            class="govuk-button govuk-button--secondary"
            (click)="onCancel()">
      Cancel
    </button>
  </ng-template>
  <span class="aui-comment__private">private</span>
</form>

